<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. 指针与数组</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch23.html" title="第 23 章 指针" /><link rel="prev" href="ch23s02.html" title="2. 指针类型的参数和返回值" /><link rel="next" href="ch23s04.html" title="4. 指针与const限定符" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. 指针与数组</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch23s02.html">上一页</a> </td><th width="60%" align="center">第 23 章 指针</th><td width="20%" align="right"> <a accesskey="n" href="ch23s04.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2811560"></a>3. 指针与数组</h2></div></div></div><p>先看个例子，有如下语句：</p><pre class="programlisting">int a[10];
int *pa = &amp;a[0];
pa++;</pre><p>首先指针<code class="literal">pa</code>指向<code class="literal">a[0]</code>的地址，注意后缀运算符的优先级高于单目运算符，所以是取<code class="literal">a[0]</code>的地址，而不是取<code class="literal">a</code>的地址。然后<code class="literal">pa++</code>让<code class="literal">pa</code>指向下一个元素（也就是<code class="literal">a[1]</code>），由于<code class="literal">pa</code>是<code class="literal">int *</code>指针，一个<code class="literal">int</code>型元素占4个字节，所以<code class="literal">pa++</code>使<code class="literal">pa</code>所指向的地址加4，注意不是加1。</p><p>下面画图理解。从前面的例子我们发现，地址的具体数值其实无关紧要，关键是要说明地址之间的关系（<code class="literal">a[1]</code>位于<code class="literal">a[0]</code>之后4个字节处）以及指针与变量之间的关系（指针保存的是变量的地址），现在我们换一种画法，省略地址的具体数值，用方框表示存储空间，用箭头表示指针和变量之间的关系。</p><div class="figure"><a id="id2811671"></a><p class="title"><b>图 23.3. 指针与数组</b></p><div class="figure-contents"><div><img src="images/pointer.array.png" alt="指针与数组" /></div></div></div><br class="figure-break" /><p>既然指针可以用<code class="literal">++</code>运算符，当然也可以用<code class="literal">+</code>、<code class="literal">-</code>运算符，<code class="literal">pa+2</code>这个表达式也是有意义的，如上图所示，<code class="literal">pa</code>指向<code class="literal">a[1]</code>，那么<code class="literal">pa+2</code>指向a[3]。事实上，<code class="literal">E1[E2]</code>这种写法和<code class="literal">(*((E1)+(E2)))</code>是等价的，<code class="literal">*(pa+2)</code>也可以写成<code class="literal">pa[2]</code>，<code class="literal">pa</code>就像数组名一样，其实数组名也没有什么特殊的，<code class="literal">a[2]</code>之所以能取数组的第2个元素，是因为它等价于<code class="literal">*(a+2)</code>，在<a class="xref" href="ch08s01.html#array.intro">第 1 节 “数组的基本概念”</a>讲过数组名做右值时自动转换成指向首元素的指针，所以<code class="literal">a[2]</code>和<code class="literal">pa[2]</code>本质上是一样的，都是通过指针间接寻址访问元素。由于<code class="literal">(*((E1)+(E2)))</code>显然可以写成<code class="literal">(*((E2)+(E1)))</code>，所以<code class="literal">E1[E2]</code>也可以写成<code class="literal">E2[E1]</code>，这意味着<code class="literal">2[a]</code>、<code class="literal">2[pa]</code>这种写法也是对的，但一般不这么写。另外，由于<code class="literal">a</code>做右值使用时和<code class="literal">&amp;a[0]</code>是一个意思，所以<code class="literal">int *pa = &amp;a[0];</code>通常不这么写，而是写成更简洁的形式<code class="literal">int *pa = a;</code>。</p><p>在<a class="xref" href="ch08s01.html#array.intro">第 1 节 “数组的基本概念”</a>还讲过C语言允许数组下标是负数，现在你该明白为什么这样规定了。在上面的例子中，表达式<code class="literal">pa[-1]</code>是合法的，它和<code class="literal">a[0]</code>表示同一个元素。</p><p>现在猜一下，两个指针变量做比较运算（<code class="literal">&gt;</code>、<code class="literal">&gt;=</code>、<code class="literal">&lt;</code>、<code class="literal">&lt;=</code>、<code class="literal">==</code>、<code class="literal">!=</code>）表示什么意义？两个指针变量做减法运算又表示什么意义？</p><p>根据什么来猜？根据<a class="xref" href="ch03s03.html#func.paraarg">第 3 节 “形参和实参”</a>讲过的Rule of Least Surprise原则。你理解了指针和常数加减的概念，再根据以往使用比较运算的经验，就应该猜到<code class="literal">pa + 2 &gt; pa</code>，<code class="literal">pa - 1 == a</code>，所以指针之间的比较运算比的是地址，C语言正是这样规定的，不过C语言的规定更为严谨，只有指向同一个数组中元素的指针之间相互比较才有意义，否则没有意义。那么两个指针相减表示什么？<code class="literal">pa - a</code>等于几？因为<code class="literal">pa - 1 == a</code>，所以<code class="literal">pa - a</code>显然应该等于1，指针相减表示两个指针之间相差的元素个数，同样只有指向同一个数组中元素的指针之间相减才有意义。两个指针相加表示什么？想不出来它能有什么意义，因此C语言也规定两个指针不能相加。假如C语言为指针相加也规定了一种意义，那就相当Surprise了，不符合一般的经验。无论是设计编程语言还是设计函数接口或人机界面都是这个道理，应该尽可能让用户根据以往的经验知识就能推断出该系统的基本用法。</p><p>在取数组元素时用数组名和用指针的语法一样，但如果把数组名做左值使用，和指针就有区别了。例如<code class="literal">pa++</code>是合法的，但<code class="literal">a++</code>就不合法，<code class="literal">pa = a + 1</code>是合法的，但<code class="literal">a = pa + 1</code>就不合法。数组名做右值时转换成指向首元素的指针，但做左值仍然表示整个数组的存储空间，而不是首元素的存储空间，数组名做左值还有一点特殊之处，不支持<code class="literal">++</code>、赋值这些运算符，但支持取地址运算符<code class="literal">&amp;</code>，所以<code class="literal">&amp;a</code>是合法的，我们将在<a class="xref" href="ch23s07.html#pointer.array3">第 7 节 “指向数组的指针与多维数组”</a>介绍这种语法。</p><p>在函数原型中，如果参数是数组，则等价于参数是指针的形式，例如：</p><pre class="programlisting">void func(int a[10])
{
	...
}</pre><p>等价于：</p><pre class="programlisting">void func(int *a)
{
	...
}</pre><p>第一种形式方括号中的数字可以不写，仍然是等价的：</p><pre class="programlisting">void func(int a[])
{
	...
}</pre><p>参数写成指针形式还是数组形式对编译器来说没区别，都表示这个参数是指针，之所以规定两种形式是为了给读代码的人提供有用的信息，如果这个参数指向一个元素，通常写成指针的形式，如果这个参数指向一串元素中的首元素，则经常写成数组的形式。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch23s02.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch23.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch23s04.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2. 指针类型的参数和返回值 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 4. 指针与<code class="literal">const</code>限定符</td></tr></table></div></body></html>
