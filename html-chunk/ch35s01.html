<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1. 线程的概念</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch35.html" title="第 35 章 线程" /><link rel="prev" href="ch35.html" title="第 35 章 线程" /><link rel="next" href="ch35s02.html" title="2. 线程控制" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. 线程的概念</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch35.html">上一页</a> </td><th width="60%" align="center">第 35 章 线程</th><td width="20%" align="right"> <a accesskey="n" href="ch35s02.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2895482"></a>1. 线程的概念</h2></div></div></div><p>我们知道，进程在各自独立的地址空间中运行，进程之间共享数据需要用<code class="literal">mmap</code>或者进程间通信机制，本节我们学习如何在一个进程的地址空间中执行多个线程。有些情况需要在一个进程中同时执行多个控制流程，这时候线程就派上了用场，比如实现一个图形界面的下载软件，一方面需要和用户交互，等待和处理用户的鼠标键盘事件，另一方面又需要同时下载多个文件，等待和处理从多个网络主机发来的数据，这些任务都需要一个“<span class="quote">等待-处理</span>”的循环，可以用多线程实现，一个线程专门负责与用户交互，另外几个线程每个线程负责和一个网络主机通信。</p><p>以前我们讲过，<code class="literal">main</code>函数和信号处理函数是同一个进程地址空间中的多个控制流程，多线程也是如此，但是比信号处理函数更加灵活，信号处理函数的控制流程只是在信号递达时产生，在处理完信号之后就结束，而多线程的控制流程可以长期并存，操作系统会在各线程之间调度和切换，就像在多个进程之间调度和切换一样。由于同一进程的多个线程共享同一地址空间，因此Text Segment、Data Segment都是共享的，如果定义一个函数，在各线程中都可以调用，如果定义一个全局变量，在各线程中都可以访问到，除此之外，各线程还共享以下进程资源和环境：</p><div class="itemizedlist"><ul type="disc"><li><p>文件描述符表</p></li><li><p>每种信号的处理方式（<code class="literal">SIG_IGN</code>、<code class="literal">SIG_DFL</code>或者自定义的信号处理函数）</p></li><li><p>当前工作目录</p></li><li><p>用户id和组id</p></li></ul></div><p>但有些资源是每个线程各有一份的：</p><div class="itemizedlist"><ul type="disc"><li><p>线程id</p></li><li><p>上下文，包括各种寄存器的值、程序计数器和栈指针</p></li><li><p>栈空间</p></li><li><p><code class="literal">errno</code>变量</p></li><li><p>信号屏蔽字</p></li><li><p>调度优先级</p></li></ul></div><p>我们将要学习的线程库函数是由POSIX标准定义的，称为POSIX thread或者pthread。在Linux上线程函数位于<code class="literal">libpthread</code>共享库中，因此在编译时要加上<code class="literal">-lpthread</code>选项。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch35.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch35.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch35s02.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 35 章 线程 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2. 线程控制</td></tr></table></div></body></html>
