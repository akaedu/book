<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2. 基本语法</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch32.html" title="第 32 章 正则表达式" /><link rel="prev" href="ch32s01.html" title="1. 引言" /><link rel="next" href="ch32s03.html" title="3. sed" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. 基本语法</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32s01.html">上一页</a> </td><th width="60%" align="center">第 32 章 正则表达式</th><td width="20%" align="right"> <a accesskey="n" href="ch32s03.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2879223"></a>2. 基本语法</h2></div></div></div><p>我们知道C的变量和Shell脚本变量的定义和使用方法很不相同，表达能力也不相同，C的变量有各种类型，而Shell脚本变量都是字符串。同样道理，各种工具和编程语言所使用的正则表达式规范的语法并不相同，表达能力也各不相同，有的正则表达式规范引入很多扩展，能表达更复杂的模式，但各种正则表达式规范的基本概念都是相通的。本节介绍<code class="literal">egrep(1)</code>所使用的正则表达式，它大致上符合POSIX正则表达式规范，详见<code class="literal">regex(7)</code>（看这个man page对你的英文绝对是很好的锻炼）。希望读者仿照上一节的例子，一边学习语法，一边用<code class="literal">egrep</code>命令做实验。</p><div class="table"><a id="id2879268"></a><p class="title"><b>表 32.1. 字符类</b></p><div class="table-contents"><table summary="字符类" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字符</th><th>含义</th><th>举例</th></tr></thead><tbody><tr><td><code class="literal">.</code></td><td>匹配任意一个字符</td><td><code class="literal">abc.</code>可以匹配<code class="literal">abcd</code>、<code class="literal">abc9</code>等</td></tr><tr><td><code class="literal">[]</code></td><td>匹配括号中的任意一个字符</td><td><code class="literal">[abc]d</code>可以匹配<code class="literal">ad</code>、<code class="literal">bd</code>或<code class="literal">cd</code></td></tr><tr><td><code class="literal">-</code></td><td>在<code class="literal">[]</code>括号内表示字符范围</td><td><code class="literal">[0-9a-fA-F]</code><code class="literal"></code>可以匹配一位十六进制数字</td></tr><tr><td><code class="literal">^</code></td><td>位于<code class="literal">[]</code>括号内的开头，匹配除括号中的字符之外的任意一个字符</td><td><code class="literal">[^xy]</code>匹配除<code class="literal">xy</code>之外的任一字符，因此<code class="literal">[^xy]1</code>可以匹配<code class="literal">a1</code>、<code class="literal">b1</code>但不匹配<code class="literal">x1</code>、<code class="literal">y1</code></td></tr><tr><td><code class="literal">[[:xxx:]]</code></td><td><code class="literal">grep</code>工具预定义的一些命名字符类</td><td><code class="literal">[[:alpha:]]</code>匹配一个字母，<code class="literal">[[:digit:]]</code>匹配一个数字</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="id2879472"></a><p class="title"><b>表 32.2. 数量限定符</b></p><div class="table-contents"><table summary="数量限定符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字符</th><th>含义</th><th>举例</th></tr></thead><tbody><tr><td><code class="literal">?</code></td><td>紧跟在它前面的单元应匹配零次或一次</td><td><code class="literal">[0-9]?\.[0-9]</code>匹配<code class="literal">0.0</code>、<code class="literal">2.3</code>、<code class="literal">.5</code>等，由于<code class="literal">.</code>在正则表达式中是一个特殊字符，所以需要用<code class="literal">\</code>转义一下，取字面值</td></tr><tr><td><code class="literal">+</code></td><td>紧跟在它前面的单元应匹配一次或多次</td><td><code class="literal">[a-zA-Z0-9_.-]+@[a-zA-Z0-9_.-]+\.[a-zA-Z0-9_.-]+</code>匹配email地址</td></tr><tr><td><code class="literal">*</code></td><td>紧跟在它前面的单元应匹配零次或多次</td><td><code class="literal">[0-9][0-9]*</code>匹配至少一位数字，等价于<code class="literal">[0-9]+</code>，<code class="literal">[a-zA-Z_]+[a-zA-Z_0-9]*</code>匹配C语言的标识符</td></tr><tr><td><code class="literal">{N}</code></td><td>紧跟在它前面的单元应精确匹配<code class="literal">N次</code></td><td><code class="literal">[1-9][0-9]{2}</code>匹配从<code class="literal">100</code>到<code class="literal">999</code>的整数</td></tr><tr><td><code class="literal">{N,}</code></td><td>紧跟在它前面的单元应匹配至少<code class="literal">N</code>次</td><td><code class="literal">[1-9][0-9]{2,}</code>匹配三位以上（含三位）的整数</td></tr><tr><td><code class="literal">{,M}</code></td><td>紧跟在它前面的单元应匹配最多<code class="literal">M</code>次</td><td><code class="literal">[0-9]{,1}</code>相当于<code class="literal">[0-9]?</code></td></tr><tr><td><code class="literal">{N,M}</code></td><td>紧跟在它前面的单元应匹配至少<code class="literal">N</code>次，最多<code class="literal">M</code>次</td><td><code class="literal">[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}</code>匹配IP地址</td></tr></tbody></table></div></div><br class="table-break" /><p>再次注意<code class="literal">grep</code>找的是包含某一模式的行，而不是完全匹配某一模式的行。再举个例子，如果文本文件的内容是</p><pre class="programlisting">aaabc
aad
efg</pre><p>查找<code class="literal">a*</code>这个模式的结果是三行都被找出来了</p><pre class="screen">$ egrep 'a*' testfile 
aabc
aad
efg</pre><p><code class="literal">a*</code>匹配0个或多个<code class="literal">a</code>，而第三行包含0个<code class="literal">a</code>，所以也包含了这一模式。单独用<code class="literal">a*</code>这样的正则表达式做查找没什么意义，一般是把<code class="literal">a*</code>作为正则表达式的一部分来用。</p><div class="table"><a id="id2879776"></a><p class="title"><b>表 32.3. 位置限定符</b></p><div class="table-contents"><table summary="位置限定符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字符</th><th>含义</th><th>举例</th></tr></thead><tbody><tr><td><code class="literal">^</code></td><td>匹配行首的位置</td><td><code class="literal">^Content</code>匹配位于一行开头的<code class="literal">Content</code></td></tr><tr><td><code class="literal">$</code></td><td>匹配行末的位置</td><td><code class="literal">;$</code>匹配位于一行结尾的<code class="literal">;</code>号，<code class="literal">^$</code>匹配空行</td></tr><tr><td><code class="literal">\&lt;</code></td><td>匹配单词开头的位置</td><td><code class="literal">\&lt;th</code>匹配<code class="literal">... this</code>，但不匹配<code class="literal">ethernet</code>、<code class="literal">tenth</code></td></tr><tr><td><code class="literal">\&gt;</code></td><td>匹配单词结尾的位置</td><td><code class="literal">p\&gt;</code>匹配<code class="literal">leap ...</code>，但不匹配<code class="literal">parent</code>、<code class="literal">sleepy</code></td></tr><tr><td><code class="literal">\b</code></td><td>匹配单词开头或结尾的位置</td><td><code class="literal">\bat\b</code>匹配<code class="literal">... at ...</code>，但不匹配<code class="literal">cat</code>、<code class="literal">atexit</code>、<code class="literal">batch</code></td></tr><tr><td><code class="literal">\B</code></td><td>匹配非单词开头和结尾的位置</td><td><code class="literal">\Bat\B</code>匹配<code class="literal">battery</code>，但不匹配<code class="literal">... attend</code>、<code class="literal">hat ...</code></td></tr></tbody></table></div></div><br class="table-break" /><p>位置限定符可以帮助<code class="literal">grep</code>更准确地查找，例如上一节我们用<code class="literal">[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}</code>查找IP地址，找到这两行</p><pre class="screen">192.168.1.1
1234.234.04.5678</pre><p>如果用<code class="literal">^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$</code>查找，就可以把<code class="literal">1234.234.04.5678</code>这一行过滤掉了。</p><div class="table"><a id="id2880045"></a><p class="title"><b>表 32.4. 其它特殊字符</b></p><div class="table-contents"><table summary="其它特殊字符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字符</th><th>含义</th><th>举例</th></tr></thead><tbody><tr><td><code class="literal">\</code></td><td>转义字符，普通字符转义为特殊字符，特殊字符转义为普通字符</td><td>普通字符<code class="literal">&lt;</code>写成<code class="literal">\&lt;</code>表示单词开头的位置，特殊字符<code class="literal">.</code>写成<code class="literal">\.</code>以及<code class="literal">\</code>写成<code class="literal">\\</code>就当作普通字符来匹配</td></tr><tr><td><code class="literal">()</code></td><td>将正则表达式的一部分括起来组成一个单元，可以对整个单元使用数量限定符</td><td><code class="literal">([0-9]{1,3}\.){3}[0-9]{1,3}</code>匹配IP地址</td></tr><tr><td><code class="literal">|</code></td><td>连接两个子表达式，表示或的关系</td><td><code class="literal">n(o|either)</code>匹配<code class="literal">no</code>或<code class="literal">neither</code></td></tr></tbody></table></div></div><br class="table-break" /><p>以上介绍的是<code class="literal">grep</code>正则表达式的Extended规范，Basic规范也有这些语法，只是字符<code class="literal">?+{}|()</code>应解释为普通字符，要表示上述特殊含义则需要加<code class="literal">\</code>转义。如果用<code class="literal">grep</code>而不是<code class="literal">egrep</code>，并且不加<code class="literal">-E</code>参数，则应该遵照Basic规范来写正则表达式。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32s01.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch32.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch32s03.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">1. 引言 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 3. sed</td></tr></table></div></body></html>
