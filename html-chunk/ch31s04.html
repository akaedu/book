<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. bash启动脚本</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch31.html" title="第 31 章 Shell脚本" /><link rel="prev" href="ch31s03.html" title="3. Shell的基本语法" /><link rel="next" href="ch31s05.html" title="5. Shell脚本语法" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. bash启动脚本</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch31s03.html">上一页</a> </td><th width="60%" align="center">第 31 章 Shell脚本</th><td width="20%" align="right"> <a accesskey="n" href="ch31s05.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2873178"></a>4. bash启动脚本</h2></div></div></div><p>启动脚本是<code class="literal">bash</code>启动时自动执行的脚本。用户可以把一些环境变量的设置和<code class="literal">alias</code>、<code class="literal">umask</code>设置放在启动脚本中，这样每次启动Shell时这些设置都自动生效。思考一下，<code class="literal">bash</code>在执行启动脚本时是以<code class="literal">fork</code>子Shell方式执行的还是以<code class="literal">source</code>方式执行的？</p><p>启动bash的方法不同，执行启动脚本的步骤也不相同，具体可分为以下几种情况。</p><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873231"></a>4.1. 作为交互登录Shell启动，或者使用--login参数启动</h3></div></div></div><p>交互Shell是指用户在提示符下输命令的Shell而非执行脚本的Shell，登录Shell就是在输入用户名和密码登录后得到的Shell，比如从字符终端登录或者用<code class="literal">telnet</code>/<code class="literal">ssh</code>从远程登录，但是从图形界面的窗口管理器登录之后会显示桌面而不会产生登录Shell（也不会执行启动脚本），在图形界面下打开终端窗口得到的Shell也不是登录Shell。</p><p>这样启动<code class="literal">bash</code>会自动执行以下脚本：</p><div class="orderedlist"><ol type="1"><li><p>首先执行<code class="literal">/etc/profile</code>，系统中每个用户登录时都要执行这个脚本，如果系统管理员希望某个设置对所有用户都生效，可以写在这个脚本里</p></li><li><p>然后依次查找当前用户主目录的<code class="literal">~/.bash_profile</code>、<code class="literal">~/.bash_login</code>和<code class="literal">~/.profile</code>三个文件，找到第一个存在并且可读的文件来执行，如果希望某个设置只对当前用户生效，可以写在这个脚本里，由于这个脚本在<code class="literal">/etc/profile</code>之后执行，<code class="literal">/etc/profile</code>设置的一些环境变量的值在这个脚本中可以修改，也就是说，当前用户的设置可以覆盖（Override）<a id="id2873327" class="indexterm"></a>系统中全局的设置。<code class="literal">~/.profile</code>这个启动脚本是<code class="literal">sh</code>规定的，<code class="literal">bash</code>规定首先查找以<code class="literal">~/.bash_</code>开头的启动脚本，如果没有则执行<code class="literal">~/.profile</code>，是为了和<code class="literal">sh</code>保持一致。</p></li><li><p>顺便一提，在退出登录时会执行<code class="literal">~/.bash_logout</code>脚本（如果它存在的话）。</p></li></ol></div></div><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873387"></a>4.2. 以交互非登录Shell启动</h3></div></div></div><p>比如在图形界面下开一个终端窗口，或者在登录Shell提示符下再输入<code class="literal">bash</code>命令，就得到一个交互非登录的Shell，这种Shell在启动时自动执行<code class="literal">~/.bashrc</code>脚本。</p><p>为了使登录Shell也能自动执行<code class="literal">~/.bashrc</code>，通常在<code class="literal">~/.bash_profile</code>中调用<code class="literal">~/.bashrc</code>：</p><pre class="programlisting">if [ -f ~/.bashrc ]; then
    . ~/.bashrc
fi</pre><p>这几行的意思是如果<code class="literal">~/.bashrc</code>文件存在则<code class="literal">source</code>它。多数Linux发行版在创建帐户时会自动创建<code class="literal">~/.bash_profile</code>和<code class="literal">~/.bashrc</code>脚本，<code class="literal">~/.bash_profile</code>中通常都有上面这几行。所以，如果要在启动脚本中做某些设置，使它在图形终端窗口和字符终端的Shell中都起作用，最好就是在<code class="literal">~/.bashrc</code>中设置。</p><p>下面做一个实验，在<code class="literal">~/.bashrc</code>文件末尾添加一行（如果这个文件不存在就创建它）：</p><pre class="programlisting">export PATH=$PATH:/home/akaedu</pre><p>然后关掉终端窗口重新打开，或者从字符终端<code class="literal">logout</code>之后重新登录，现在主目录下的程序应该可以直接输程序名运行而不必输入路径了，例如：</p><pre class="screen">~$ a.out</pre><p>就可以了，而不必</p><pre class="screen">~$ ./a.out</pre><p>为什么登录Shell和非登录Shell的启动脚本要区分开呢？最初的设计是这样考虑的，如果从字符终端或者远程登录，那么登录Shell是该用户的所有其它进程的父进程，也是其它子Shell的父进程，所以环境变量在登录Shell的启动脚本里设置一次就可以自动带到其它非登录Shell里，而Shell的本地变量、函数、<code class="literal">alias</code>等设置没有办法带到子Shell里，需要每次启动非登录Shell时设置一遍，所以就需要有非登录Shell的启动脚本，所以一般来说在<code class="literal">~/.bash_profile</code>里设置环境变量，在<code class="literal">~/.bashrc</code>里设置本地变量、函数、<code class="literal">alias</code>等。如果你的Linux带有图形系统则不能这样设置，由于从图形界面的窗口管理器登录并不会产生登录Shell，所以环境变量也应该在<code class="literal">~/.bashrc</code>里设置。
</p></div><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873571"></a>4.3. 非交互启动</h3></div></div></div><p>为执行脚本而<code class="literal">fork</code>出来的子Shell是非交互Shell，启动时执行的脚本文件由环境变量<code class="literal">BASH_ENV</code>定义，相当于自动执行以下命令：</p><pre class="programlisting">if [ -n "$BASH_ENV" ]; then . "$BASH_ENV"; fi</pre><p>如果环境变量<code class="literal">BASH_ENV</code>的值不是空字符串，则把它的值当作启动脚本的文件名，<code class="literal">source</code>这个脚本。</p></div><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873616"></a>4.4. 以sh命令启动</h3></div></div></div><p>如果以<code class="literal">sh</code>命令启动<code class="literal">bash</code>，<code class="literal">bash</code>将模拟<code class="literal">sh</code>的行为，以<code class="literal">~/.bash_</code>开头的那些启动脚本就不认了。所以，如果作为交互登录Shell启动，或者使用--login参数启动，则依次执行以下脚本：</p><div class="orderedlist"><ol type="1"><li><p><code class="literal">/etc/profile</code></p></li><li><p><code class="literal">~/.profile</code></p></li></ol></div><p>如果作为交互Shell启动，相当于自动执行以下命令：</p><pre class="programlisting">if [ -n "$ENV" ]; then . "$ENV"; fi</pre><p>如果作为非交互Shell启动，则不执行任何启动脚本。通常我们写的Shell脚本都以<code class="literal">#! /bin/sh</code>开头，都属于这种方式。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch31s03.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch31.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch31s05.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">3. Shell的基本语法 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 5. Shell脚本语法</td></tr></table></div></body></html>
