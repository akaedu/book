<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. awk</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch32.html" title="第 32 章 正则表达式" /><link rel="prev" href="ch32s03.html" title="3. sed" /><link rel="next" href="ch32s05.html" title="5. 练习：在C语言中使用正则表达式" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. awk</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32s03.html">上一页</a> </td><th width="60%" align="center">第 32 章 正则表达式</th><td width="20%" align="right"> <a accesskey="n" href="ch32s05.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2880797"></a>4. awk</h2></div></div></div><p><code class="literal">sed</code>以行为单位处理文件，<code class="literal">awk</code>比<code class="literal">sed</code>强的地方在于不仅能以行为单位还能以列为单位处理文件。<code class="literal">awk</code>缺省的行分隔符是换行，缺省的列分隔符是连续的空格和Tab，但是行分隔符和列分隔符都可以自定义，比如<code class="literal">/etc/passwd</code>文件的每一行有若干个字段，字段之间以<code class="literal">:</code>分隔，就可以重新定义<code class="literal">awk</code>的列分隔符为<code class="literal">:</code>并以列为单位处理这个文件。<code class="literal">awk</code>实际上是一门很复杂的脚本语言，还有像C语言一样的分支和循环结构，但是基本用法和<code class="literal">sed</code>类似，<code class="literal">awk</code>命令行的基本形式为：</p><pre class="programlisting">awk option 'script' file1 file2 ...
awk option -f scriptfile file1 file2 ...</pre><p>和<code class="literal">sed</code>一样，<code class="literal">awk</code>处理的文件既可以由标准输入重定向得到，也可以当命令行参数传入，编辑命令可以直接当命令行参数传入，也可以用<code class="literal">-f</code>参数指定一个脚本文件，编辑命令的格式为：</p><pre class="programlisting">/pattern/{actions}
condition{actions}</pre><p>和<code class="literal">sed</code>类似，<code class="literal">pattern</code>是正则表达式，<code class="literal">actions</code>是一系列操作。<code class="literal">awk</code>程序一行一行读出待处理文件，如果某一行与<code class="literal">pattern</code>匹配，或者满足<code class="literal">condition</code>条件，则执行相应的<code class="literal">actions</code>，如果一条<code class="literal">awk</code>命令只有<code class="literal">actions</code>部分，则<code class="literal">actions</code>作用于待处理文件的每一行。比如文件<code class="literal">testfile</code>的内容表示某商店的库存量：</p><pre class="programlisting">ProductA  30
ProductB  76
ProductC  55</pre><p>打印每一行的第二列:</p><pre class="screen">$ awk '{print $2;}' testfile
30
76
55</pre><p>自动变量<code class="literal">$1</code>、<code class="literal">$2</code>分别表示第一列、第二列等，类似于Shell脚本的位置参数，而<code class="literal">$0</code>表示整个当前行。再比如，如果某种产品的库存量低于75则在行末标注需要订货：</p><pre class="programlisting">$ awk '$2&lt;75 {printf "%s\t%s\n", $0, "REORDER";} $2&gt;=75 {print $0;}' testfile
ProductA  30    REORDER
ProductB  76
ProductC  55    REORDER</pre><p>可见<code class="literal">awk</code>也有和C语言非常相似的<code class="literal">printf</code>函数。<code class="literal">awk</code>命令的<code class="literal">condition</code>部分还可以是两个特殊的<code class="literal">condition</code>－<code class="literal">BEGIN</code>和<code class="literal">END</code>，对于每个待处理文件，<code class="literal">BEGIN</code>后面的<code class="literal">actions</code>在处理整个文件之前执行一次，<code class="literal">END</code>后面的<code class="literal">actions</code>在整个文件处理完之后执行一次。</p><p><code class="literal">awk</code>命令可以像C语言一样使用变量（但不需要定义变量），比如统计一个文件中的空行数</p><pre class="screen">$ awk '/^ *$/ {x=x+1;} END {print x;}' testfile</pre><p>就像Shell的环境变量一样，有些<code class="literal">awk</code>变量是预定义的有特殊含义的：</p><div class="table"><a id="id2881116"></a><p class="title"><b>表 32.6. awk常用的内建变量</b></p><div class="table-contents"><table summary="awk常用的内建变量" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>FILENAME</td><td>当前输入文件的文件名，该变量是只读的</td></tr><tr><td>NR</td><td>当前行的行号，该变量是只读的，<code class="literal">R</code>代表record</td></tr><tr><td>NF</td><td>当前行所拥有的列数，该变量是只读的，<code class="literal">F</code>代表field</td></tr><tr><td>OFS</td><td>输出格式的列分隔符，缺省是空格</td></tr><tr><td>FS</td><td>输入文件的列分融符，缺省是连续的空格和Tab</td></tr><tr><td>ORS</td><td>输出格式的行分隔符，缺省是换行符</td></tr><tr><td>RS</td><td>输入文件的行分隔符，缺省是换行符</td></tr></tbody></table></div></div><br class="table-break" /><p>例如打印系统中的用户帐号列表</p><pre class="screen">$ awk 'BEGIN {FS=":"} {print $1;}' /etc/passwd</pre><p><code class="literal">awk</code>还可以像C语言一样使用<code class="literal">if</code>/<code class="literal">else</code>、<code class="literal">while</code>、<code class="literal">for</code>控制结构，此处从略。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32s03.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch32.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch32s05.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">3. sed </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 5. 练习：在C语言中使用正则表达式</td></tr></table></div></body></html>
