<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1. 引言</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch32.html" title="第 32 章 正则表达式" /><link rel="prev" href="ch32.html" title="第 32 章 正则表达式" /><link rel="next" href="ch32s02.html" title="2. 基本语法" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. 引言</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32.html">上一页</a> </td><th width="60%" align="center">第 32 章 正则表达式</th><td width="20%" align="right"> <a accesskey="n" href="ch32s02.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2878891"></a>1. 引言</h2></div></div></div><p>以前我们用<code class="literal">grep</code>在一个文件中找出包含某些字符串的行，比如在头文件中找出一个宏定义。其实<code class="literal">grep</code>还可以找出<span class="emphasis"><em>符合某个模式（Pattern）<a id="id2878281" class="indexterm"></a>的一类字符串</em></span>。例如找出所有符合<code class="literal">xxxxx@xxxx.xxx</code>模式的字符串（也就是email地址），要求x字符可以是字母、数字、下划线、小数点或减号，email地址的每一部分可以有一个或多个x字符，例如<code class="literal">abc.d@ef.com</code>、<code class="literal">1_2@987-6.54</code>，当然符合这个模式的不全是合法的email地址，但至少可以做一次初步筛选，筛掉<code class="literal">a.b</code>、<code class="literal">c@d</code>等肯定不是email地址的字符串。再比如，找出所有符合<code class="literal">yyy.yyy.yyy.yyy</code>模式的字符串（也就是IP地址），要求y是0-9的数字，IP地址的每一部分可以有1-3个y字符。</p><p>如果要用<code class="literal">grep</code>查找一个模式，如何表示这个模式，这一类字符串，而不是一个特定的字符串呢？从这两个简单的例子可以看出，要表示一个模式至少应该包含以下信息：</p><div class="itemizedlist"><ul type="disc"><li><p>字符类（Character Class）<a id="id2878960" class="indexterm"></a>：如上例的x和y，它们在模式中表示一个字符，但是取值范围是一类字符中的任意一个。</p></li><li><p>数量限定符（Quantifier）<a id="id2878974" class="indexterm"></a>： 邮件地址的每一部分可以有<span class="emphasis"><em>一个或多个</em></span>x字符，IP地址的每一部分可以有<span class="emphasis"><em>1-3个</em></span>y字符</p></li><li><p>各种字符类以及普通字符之间的位置关系：例如邮件地址分三部分，用普通字符<code class="literal">@</code>和<code class="literal">.</code>隔开，IP地址分四部分，用<code class="literal">.</code>隔开，每一部分都可以用字符类和数量限定符描述。为了表示位置关系，还有位置限定符（Anchor）<a id="id2879017" class="indexterm"></a>的概念，将在下面介绍。</p></li></ul></div><p>规定一些特殊语法表示字符类、数量限定符和位置关系，然后用这些特殊语法和普通字符一起表示一个模式，这就是正则表达式（Regular Expression）<a id="id2879032" class="indexterm"></a>。例如email地址的正则表达式可以写成<code class="literal">[a-zA-Z0-9_.-]+@[a-zA-Z0-9_.-]+\.[a-zA-Z0-9_.-]+</code>，IP地址的正则表达式可以写成<code class="literal">[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}</code>。下一节介绍正则表达式的语法，我们先看看正则表达式在<code class="literal">grep</code>中怎么用。例如有这样一个文本文件<code class="literal">testfile</code>：</p><pre class="programlisting">192.168.1.1
1234.234.04.5678
123.4234.045.678
abcde</pre><p>查找其中包含IP地址的行：</p><pre class="screen">$ egrep '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' testfile
192.168.1.1
1234.234.04.5678</pre><p><code class="literal">egrep</code>相当于<code class="literal">grep -E</code>，表示采用Extended正则表达式语法。<code class="literal">grep</code>的正则表达式有Basic和Extended两种规范，它们之间的区别下一节再解释。另外还有<code class="literal">fgrep</code>命令，相当于<code class="literal">grep -F</code>，表示只搜索固定字符串而不搜索正则表达式模式，不会按正则表达式的语法解释后面的参数。</p><p>注意正则表达式参数用单引号括起来了，因为正则表达式中用到的很多特殊字符在Shell中也有特殊含义（例如\），只有用单引号括起来才能保证这些字符原封不动地传给<code class="literal">grep</code>命令，而不会被Shell解释掉。</p><p><code class="literal">192.168.1.1</code>符合上述模式，由三个<code class="literal">.</code>隔开的四段组成，每段都是1到3个数字，所以这一行被找出来了，可为什么<code class="literal">1234.234.04.5678</code>也被找出来了呢？因为<code class="literal">grep</code>找的是<span class="emphasis"><em>包含</em></span>某一模式的行，这一行包含一个符合模式的字符串<code class="literal">234.234.04.567</code>。相反，<code class="literal">123.4234.045.678</code>这一行不包含符合模式的字符串，所以不会被找出来。</p><p><code class="literal">grep</code>是一种查找过滤工具，正则表达式在<code class="literal">grep</code>中用来查找符合模式的字符串。其实正则表达式还有一个重要的应用是验证用户输入是否合法，例如用户通过网页表单提交自己的email地址，就需要用程序验证一下是不是合法的email地址，这个工作可以在网页的Javascript中做，也可以在网站后台的程序中做，例如PHP、Perl、Python、Ruby、Java或C，所有这些语言都支持正则表达式，可以说，目前不支持正则表达式的编程语言实在很少见。除了编程语言之外，很多UNIX命令和工具也都支持正则表达式，例如grep、vi、sed、awk、emacs等等。“<span class="quote">正则表达式</span>”就像“<span class="quote">变量</span>”一样，它是一个广泛的概念，而不是某一种工具或编程语言的特性。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch32.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch32s02.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 32 章 正则表达式 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2. 基本语法</td></tr></table></div></body></html>
