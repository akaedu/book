<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5. 表达式</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C编程一站式学习" /><link rel="up" href="ch02.html" title="第 2 章 常量、变量和表达式" /><link rel="prev" href="ch02s04.html" title="4. 赋值" /><link rel="next" href="ch02s06.html" title="6. 字符类型与字符编码" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. 表达式</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s04.html">上一页</a> </td><th width="60%" align="center">第 2 章 常量、变量和表达式</th><td width="20%" align="right"> <a accesskey="n" href="ch02s06.html">下一页</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="expr.expression"></a>5. 表达式</h2></div></div></div><p>常量和变量都可以参与加减乘除运算，例如<code class="literal">1+1</code>、<code class="literal">hour-1</code>、<code class="literal">hour * 60 + minute</code>、<code class="literal">minute/60</code>等。这里的+ - * /称为运算符（Operator）<a id="id2708948" class="indexterm"></a>，而参与运算的常量和变量称为操作数（Operand）<a id="id2708956" class="indexterm"></a>，上面四个由运算符和操作数所组成的算式称为表达式（Expression）<a id="id2708965" class="indexterm"></a>。</p><p>和数学上规定的一样，<code class="literal">hour * 60 + minute</code>这个表达式应该先算乘再算加，也就是说运算符是有优先级（Precedence）<a id="id2708982" class="indexterm"></a>的，*和/是同一优先级，+和-是同一优先级，*和/的优先级高于+和-。对于同一优先级的运算从左到右计算，如果不希望按默认的优先级计算则要加()括号（Parenthesis）<a id="id2708993" class="indexterm"></a>。例如<code class="literal">(3+4)*5/6</code>应先算3+4，再算*5，再算/6。</p><p>前面讲过打印语句和赋值语句，现在我们定义：在任意表达式后面加个;号也是一种语句，称为表达式语句。例如：</p><pre class="programlisting">hour * 60 + minute;</pre><p>这是个合法的语句，但这个语句在程序中起不到任何作用，把hour的值和minute的值取出来加乘，得到的计算结果却没有保存，白算了一通。再比如：</p><pre class="programlisting">int total_minute;
total_minute = hour * 60 + minute;</pre><p>这个语句就很有意义，把计算结果保存在另一个变量<code class="literal">total_minute</code>里。事实上等号也是一种运算符，称为赋值运算符，赋值语句就是一种表达式语句，等号的优先级比+和*都低，所以先算出等号右边的结果然后才做赋值操作，整个表达式<code class="literal">total_minute = hour * 60 + minute</code>加个;号构成一个语句。</p><p><span class="emphasis"><em>任何表达式都有值和类型两个基本属性</em></span>。<code class="literal">hour * 60 + minute</code>的值是由三个<code class="literal">int</code>型的操作数计算出来的，所以这个表达式的类型也是<code class="literal">int</code>型。同理，表达式<code class="literal">total_minute = hour * 60 + minute</code>的类型也是<code class="literal">int</code>，它的值是多少呢？C语言规定等号运算符的计算结果就是等号左边被赋予的那个值，所以这个表达式的值和<code class="literal">hour * 60 + minute</code>的值相同，也和<code class="literal">total_minute</code>的值相同。</p><p>等号运算符还有一个和+ - * /不同的特性，如果一个表达式中出现多个等号，不是从左到右计算而是从右到左计算，例如：</p><pre class="programlisting">int total_minute, total;
total = total_minute = hour * 60 + minute;</pre><p>计算顺序是先算<code class="literal">hour * 60 + minute</code>得到一个结果，然后算右边的等号，就是把<code class="literal">hour * 60 + minute</code>的结果赋给变量<code class="literal">total_minute</code>，这个结果同时也是整个表达式<code class="literal">total_minute = hour * 60 + minute</code>的值，再算左边的等号，即把这个值再赋给变量<code class="literal">total</code>。同样优先级的运算符是从左到右计算还是从右到左计算称为运算符的结合性（Associativity）<a id="id2709138" class="indexterm"></a>。+ - * /是左结合的，等号是右结合的。</p><p>现在我们总结一下到目前为止学过的语法规则：</p><div class="literallayout"><p>表达式 → 标识符<br />
表达式 → 常量<br />
表达式 → 字符串字面值<br />
表达式 → (表达式)<br />
表达式 → 表达式 + 表达式<br />
表达式 → 表达式 - 表达式<br />
表达式 → 表达式 * 表达式<br />
表达式 → 表达式 / 表达式<br />
表达式 → 表达式 = 表达式<br />
语句 → 表达式;<br />
语句 → printf(表达式, 表达式, 表达式, ...);<br />
变量声明 → 类型 标识符 = Initializer, 标识符 = Initializer, ...;<br />
（= Initializer的部分可以不写）</p></div><p>注意，<span class="emphasis"><em>本书所列的语法规则都是简化过的，是不准确的，目的是为了便于初学者理解</em></span>，比如上面所列的语法规则并没有描述运算符的优先级和结合性。完整的C语法规则请参考<a class="xref" href="bi01.html#bibli.c99" title="ISO/IEC 9899: Programming Languages － C">[<abbr class="abbrev">C99</abbr>]</a>的Annex A。</p><p>表达式可以是单个的常量或变量，也可以是根据以上规则组合而成的更复杂的表达式。以前我们用<code class="literal">printf</code>打印常量或变量的值，现在可以用<code class="literal">printf</code>打印更复杂的表达式的值，例如：</p><pre class="programlisting">printf("%d:%d is %d minutes after 00:00\n", hour, minute, hour * 60 + minute);</pre><p>编译器在翻译这条语句时，首先根据上述语法规则把这个语句解析成下图所示的语法树，然后再根据语法树生成相应的指令。语法树的末端的是一个个Token，每一步展开利用一条语法规则。</p><div class="figure"><a id="id2709228"></a><p class="title"><b>图 2.2. 语法树</b></p><div class="figure-contents"><div><img src="images/expr.parse.png" alt="语法树" /></div></div></div><br class="figure-break" /><p>根据这些语法规则进一步组合可以写出更复杂的语句，比如在一条语句中完成计算、赋值和打印功能：</p><pre class="programlisting">printf("%d:%d is %d minutes after 00:00\n", hour, minute, total_minute = hour * 60 + minute);</pre><p>理解组合（Composition）<a id="id2709254" class="indexterm"></a>规则是理解语法规则的关键所在，正因为可以根据语法规则任意组合，我们才可以用简单的常量、变量、表达式、语句搭建出任意复杂的程序，以后我们学习新的语法规则时会进一步体会到这一点。从上面的例子可以看出，表达式不宜过度组合，否则会给阅读和调试带来困难。</p><p>根据语法规则组合出来的表达式在语义上并不总是正确的，例如：</p><pre class="programlisting">minute + 1 = hour;</pre><p>等号左边的表达式要求表示一个存储位置而不是一个值，这是等号运算符和+ - * /运算符的又一个显著不同。有的表达式既可以表示一个存储位置也可以表示一个值，而有的表达式只能表示值，不能表示存储位置，例如<code class="literal">minute + 1</code>这个表达式就不能表示存储位置，放在等号左边是语义错误。表达式所表示的存储位置称为左值（lvalue）<a id="id2709298" class="indexterm"></a>（允许放在等号左边），而以前我们所说的表达式的值也称为右值（rvalue）<a id="id2709307" class="indexterm"></a>（只能放在等号右边）。上面的话换一种说法就是：<span class="emphasis"><em>有的表达式既可以做左值也可以做右值，而有的表达式只能做右值</em></span>。目前我们学过的表达式中只有变量可以做左值，可以做左值的表达式还有几种，以后会讲到。</p><p>我们看一个有意思的例子，如果定义三个变量<code class="literal">int a, b, c;</code>，表达式<code class="literal">a = b = c</code>是合法的，先求<code class="literal">b = c</code>的值，再把这个值赋给<code class="literal">a</code>，而表达式<code class="literal">(a = b) = c</code>是不合法的，先求<code class="literal">(a = b)</code>的值没问题，但<code class="literal">(a = b)</code>这个表达式不能再做左值了，因此放在<code class="literal">= c</code>的等号左边是错的。</p><p>关于整数除法运算有一点特殊之处：</p><pre class="programlisting">hour = 11;
minute = 59;
printf("%d and %d hours\n", hour, minute / 60);</pre><p>执行结果是<code class="literal">11 and 0 hours</code>，也就是说59/60得0，这是因为两个<code class="literal">int</code>型操作数相除的表达式仍为<code class="literal">int</code>型，只能保存计算结果的整数部分，即使小数部分是0.98也要舍去。</p><p>向下取整的运算称为Floor<a id="id2709407" class="indexterm"></a>，用数学符号⌊⌋表示；向上取整的运算称为Ceiling<a id="id2709422" class="indexterm"></a>，用数学符号⌈⌉表示。例如：</p><div class="literallayout"><p>⌊59/60⌋=0<br />
⌈59/60⌉=1<br />
⌊-59/60⌋=-1<br />
⌈-59/60⌉=0</p></div><p>在C语言中整数除法取的既不是Floor也不是Ceiling，无论操作数是正是负总是把小数部分截掉，在数轴上向零的方向取整（Truncate toward Zero）<a id="id2709441" class="indexterm"></a>，或者说当操作数为正的时候相当于Floor，当操作符为负的时候相当于Ceiling。回到先前的例子，要得到更精确的结果可以这样：</p><pre class="programlisting">printf("%d hours and %d percent of an hour\n", hour, minute * 100 / 60);
printf("%d and %f hours\n", hour, minute / 60.0);</pre><p>在第二个<code class="literal">printf</code>中，表达式是<code class="literal">minute / 60.0</code>，60.0是<code class="literal">double</code>型的，/运算符要求左右两边的操作数类型一致，而现在并不一致。C语言规定了一套隐式类型转换规则，在这里编译器自动把左边的<code class="literal">minute</code>也转成<code class="literal">double</code>型来计算，整个表达式的值也是<code class="literal">double</code>型的，在格式化字符串中应该用<code class="literal">%f</code>转换说明与之对应。本来编程语言作为一种形式语言要求有简单而严格的规则，自动类型转换规则不仅很复杂，而且使C语言的形式看起来也不那么严格了，C语言这么设计是为了书写程序简便而做的折衷，有些事情编译器可以自动做好，程序员就不必每次都写一堆繁琐的转换代码。然而C语言的类型转换规则非常难掌握，本书的前几章会尽量避免类型转换，到<a class="xref" href="ch15s03.html#type.conversion">第 3 节 “类型转换”</a>再集中解决这个问题。</p><div class="simplesect" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2709526"></a>习题</h3></div></div></div><p>1、假设变量<code class="literal">x</code>和<code class="literal">n</code>是两个正整数，我们知道<code class="literal">x/n</code>这个表达式的结果要取Floor，例如<code class="literal">x</code>是17，<code class="literal">n</code>是4，则结果是4。如果希望结果取Ceiling应该怎么写表达式呢？例如<code class="literal">x</code>是17，<code class="literal">n</code>是4，则结果是5；<code class="literal">x</code>是16，<code class="literal">n</code>是4，则结果是4。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s04.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch02.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch02s06.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">4. 赋值 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6. 字符类型与字符编码</td></tr></table></div></body></html>
